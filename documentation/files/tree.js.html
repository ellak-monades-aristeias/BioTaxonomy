<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>tree.js</title>
    <link rel="stylesheet" href="http://yui.yahooapis.com/3.9.1/build/cssgrids/cssgrids-min.css">
    <link rel="stylesheet" href="../assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="../assets/css/main.css" id="site_styles">
    <link rel="icon" href="../assets/favicon.ico">
    <script src="http://yui.yahooapis.com/combo?3.9.1/build/yui/yui-min.js"></script>
</head>
<body class="yui3-skin-sam">

<div id="doc">
    <div id="hd" class="yui3-g header">
        <div class="yui3-u-3-4">
                <h1><img src="../assets/css/logo.png" title="" width="117" height="52"></h1>
        </div>
        <div class="yui3-u-1-4 version">
            <em>API Docs for: </em>
        </div>
    </div>
    <div id="bd" class="yui3-g">

        <div class="yui3-u-1-4">
            <div id="docs-sidebar" class="sidebar apidocs">
                <div id="api-list">
                    <h2 class="off-left">APIs</h2>
                    <div id="api-tabview" class="tabview">
                        <ul class="tabs">
                            <li><a href="#api-classes">Classes</a></li>
                            <li><a href="#api-modules">Modules</a></li>
                        </ul>
                
                        <div id="api-tabview-filter">
                            <input type="search" id="api-filter" placeholder="Type to filter APIs">
                        </div>
                
                        <div id="api-tabview-panel">
                            <ul id="api-classes" class="apis classes">
                                <li><a href="../classes/$(document).on().html">$(document).on()</a></li>
                                <li><a href="../classes/ajaxError.html">ajaxError</a></li>
                                <li><a href="../classes/articleExistsQuery.html">articleExistsQuery</a></li>
                                <li><a href="../classes/articleRankSuccess.html">articleRankSuccess</a></li>
                                <li><a href="../classes/capitalizeFirstLetter.html">capitalizeFirstLetter</a></li>
                                <li><a href="../classes/ChangeDiv.html">ChangeDiv</a></li>
                                <li><a href="../classes/changeLanguage.html">changeLanguage</a></li>
                                <li><a href="../classes/checkUrl.html">checkUrl</a></li>
                                <li><a href="../classes/clearNextRanks.html">clearNextRanks</a></li>
                                <li><a href="../classes/divsForMobile.html">divsForMobile</a></li>
                                <li><a href="../classes/executeOpenQuery.html">executeOpenQuery</a></li>
                                <li><a href="../classes/getArticle.html">getArticle</a></li>
                                <li><a href="../classes/getCurrPage.html">getCurrPage</a></li>
                                <li><a href="../classes/getGreekName.html">getGreekName</a></li>
                                <li><a href="../classes/getImportantQuery.html">getImportantQuery</a></li>
                                <li><a href="../classes/getLanguageResources.html">getLanguageResources</a></li>
                                <li><a href="../classes/getMembers.html">getMembers</a></li>
                                <li><a href="../classes/getName.html">getName</a></li>
                                <li><a href="../classes/getNextRank.html">getNextRank</a></li>
                                <li><a href="../classes/getOpenQuery.html">getOpenQuery</a></li>
                                <li><a href="../classes/getPluralRank.html">getPluralRank</a></li>
                                <li><a href="../classes/getPrevRank.html">getPrevRank</a></li>
                                <li><a href="../classes/getprevRankNameQuery.html">getprevRankNameQuery</a></li>
                                <li><a href="../classes/getSearchQuery.html">getSearchQuery</a></li>
                                <li><a href="../classes/getSearchRank.html">getSearchRank</a></li>
                                <li><a href="../classes/getSearchRankQuery.html">getSearchRankQuery</a></li>
                                <li><a href="../classes/getStatistics.html">getStatistics</a></li>
                                <li><a href="../classes/getSummaryQuery.html">getSummaryQuery</a></li>
                                <li><a href="../classes/getThumbUrl.html">getThumbUrl</a></li>
                                <li><a href="../classes/getTotalQuery.html">getTotalQuery</a></li>
                                <li><a href="../classes/goBack.html">goBack</a></li>
                                <li><a href="../classes/greekNameSuccess.html">greekNameSuccess</a></li>
                                <li><a href="../classes/greekSuccess.html">greekSuccess</a></li>
                                <li><a href="../classes/hideShowDivs.html">hideShowDivs</a></li>
                                <li><a href="../classes/importantMembersSuccess.html">importantMembersSuccess</a></li>
                                <li><a href="../classes/loadArticle.html">loadArticle</a></li>
                                <li><a href="../classes/membersSuccess.html">membersSuccess</a></li>
                                <li><a href="../classes/nameFromUrl.html">nameFromUrl</a></li>
                                <li><a href="../classes/normalDivs.html">normalDivs</a></li>
                                <li><a href="../classes/openSuccess.html">openSuccess</a></li>
                                <li><a href="../classes/prettyLoadRank.html">prettyLoadRank</a></li>
                                <li><a href="../classes/prevRankSuccess.html">prevRankSuccess</a></li>
                                <li><a href="../classes/randomColorGenerator.html">randomColorGenerator</a></li>
                                <li><a href="../classes/returnGreekNameQuery.html">returnGreekNameQuery</a></li>
                                <li><a href="../classes/returnOneEnglishNameQuery.html">returnOneEnglishNameQuery</a></li>
                                <li><a href="../classes/saveTree.html">saveTree</a></li>
                                <li><a href="../classes/searchArticle.html">searchArticle</a></li>
                                <li><a href="../classes/searchSuccess.html">searchSuccess</a></li>
                                <li><a href="../classes/searchTree.html">searchTree</a></li>
                                <li><a href="../classes/shadeColor2.html">shadeColor2</a></li>
                                <li><a href="../classes/showAbout.html">showAbout</a></li>
                                <li><a href="../classes/showAllDivs.html">showAllDivs</a></li>
                                <li><a href="../classes/showArticle.html">showArticle</a></li>
                                <li><a href="../classes/showIndex.html">showIndex</a></li>
                                <li><a href="../classes/shrinkImg200.html">shrinkImg200</a></li>
                                <li><a href="../classes/shrinkImg300.html">shrinkImg300</a></li>
                                <li><a href="../classes/startLoading.html">startLoading</a></li>
                                <li><a href="../classes/stopLoading.html">stopLoading</a></li>
                                <li><a href="../classes/summarySuccess.html">summarySuccess</a></li>
                                <li><a href="../classes/thumbHtml.html">thumbHtml</a></li>
                                <li><a href="../classes/totalQuerySuccess.html">totalQuerySuccess</a></li>
                                <li><a href="../classes/treeToGreek.html">treeToGreek</a></li>
                            </ul>
                
                
                            <ul id="api-modules" class="apis modules">
                                <li><a href="../modules/Article.html">Article</a></li>
                                <li><a href="../modules/Languages.html">Languages</a></li>
                                <li><a href="../modules/Navigation.html">Navigation</a></li>
                                <li><a href="../modules/Queries.html">Queries</a></li>
                                <li><a href="../modules/Tree.html">Tree</a></li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="yui3-u-3-4">
                <div id="api-options">
                    Show:
                    <label for="api-show-inherited">
                        <input type="checkbox" id="api-show-inherited" checked>
                        Inherited
                    </label>
            
                    <label for="api-show-protected">
                        <input type="checkbox" id="api-show-protected">
                        Protected
                    </label>
            
                    <label for="api-show-private">
                        <input type="checkbox" id="api-show-private">
                        Private
                    </label>
                    <label for="api-show-deprecated">
                        <input type="checkbox" id="api-show-deprecated">
                        Deprecated
                    </label>
            
                </div>
            
            <div class="apidocs">
                <div id="docs-main">
                    <div class="content">
<h1 class="file-heading">File: tree.js</h1>

<div class="file">
    <pre class="code prettyprint linenums">
/* tree.js - Functions for index.html that handle tree creation*/
/*Functions that handle details and important taxon members*/ 
/**
 * Methods for creating the tree.
 *
 * @module Tree
 */
 
/**
* Executed when somebody clicks on a details button.
* Gets greek name translation and execute an ajax request for the node summary 
* after a time delay to ensure that greekName was passed to sessionStorage. 
* Sets sessionStorage variables in case the user wants to read the full article. 
* Sets title and image in modal window. 
*
* @class $(document).on()
* @constructor
* @param {event} &quot;click&quot; The click event
* @param {string} &quot;.details&quot; A node with class &quot;details&quot;
* @param {function} function 
*/
$(document).on(&quot;click&quot;, &quot;.details&quot;, function() {
    var name = getName($(this)); //Get name of node that was clicked

    getGreekName(name, &quot;index&quot;); //Finds greek name and stores in sessionStorage
    var button = $(this);


    setTimeout(function() {
        var rank = getRank(button);
        var img_url = button.closest(&#x27;.thumbnail&#x27;).find(&#x27;img&#x27;).attr(&#x27;data-src&#x27;);
        img_url = getImg300(img_url);

        sessionStorage.setItem(&#x27;name&#x27;, name);
        sessionStorage.setItem(&#x27;rank&#x27;, rank);
        if (sessionStorage.getItem(&#x27;lang&#x27;) == &#x27;en&#x27;) {
            $(&quot;.modal-title&quot;).text(name);
        } else {
            $(&quot;.modal-title&quot;).text(sessionStorage.getItem(&#x27;greekName&#x27;));
        }

        prevRank = getPrevRank(rank);
        var selected = $(&quot;#&quot; + prevRank).find(&quot;.selected&quot;);

        sessionStorage.setItem(&#x27;prevRankName&#x27;, selected.find(&#x27;p[caption]&#x27;).attr(&#x27;caption&#x27;));


        $(&quot;.article&quot;).attr(&#x27;onclick&#x27;, &#x27;showArticle(&quot;&#x27; + name + &#x27;&quot;)&#x27;);
        $(&#x27;#modalThumb img&#x27;).hide();
        $(&#x27;#modalThumb img&#x27;).attr(&#x27;src&#x27;, img_url);
        time = prettyLoadRank($(&#x27;#modalThumb img&#x27;), &#x27;null&#x27;, 900);
        $(&#x27;#membersList&#x27;).html(&#x27;&#x27;); //Clear memberlist data
        startLoading(&#x27;#modalSum&#x27;);

        var query = getSummaryQuery(name);
        $.ajax({
            dataType: &quot;jsonp&quot;,
            url: query,
            rank: rank,
            img_url: img_url,
            name: name,
            success: summarySuccess,
            error: ajaxError
        });
    }, 1000)


});

/**
* Callback for ajax request in details click event. 
* Adds the summary to the modal window.  
*
* @class summarySuccess
* @constructor
* @param {object} _data Ajax request response that contains node summary 
*/
function summarySuccess(_data) {
    var results = _data.query.pages;
    for (var j in results) {
        if (results[j].extract !== undefined) {
            var sum = results[j].extract;

            if (sum.length &gt; 1000) sum = sum.substr(0, 1000) + &#x27;...&#x27;;
        } else {
            var sum = &#x27;&lt;span name=&quot;lbl&quot; caption=&quot;noSummary&quot;&gt;&lt;/span&gt;&#x27;;

        }
    }
    stopLoading(&#x27;#modalSum&#x27;);
    $(&#x27;#modalSum&#x27;).hide();
    $(&#x27;#modalSum&#x27;).html(sum);
    var time = prettyLoadRank($(&#x27;#modalSum&#x27;), &#x27;null&#x27;, 700);
    startLoading(&#x27;#membersList&#x27;);
    getMembers(this.rank, this.name, &quot;index&quot;);
}

/**
* Makes ajax request to get important members of node.  
*
* @class getMembers
* @constructor
* @param {string} rank Rank of node 
* @param {string} name Name of node
* @param {string} page The page from where the function was called, either index or article 
*/
function getMembers(rank, name, page) {
    if (page != &quot;article&quot;) {
        var success = importantMembersSuccess;
    } else {
        var success = membersSuccess;
    }
    var query = getImportantQuery(rank, name.replace(&#x27; &#x27;, &quot;_&quot;));

    checkUrl();
    var queryUrl = encodeURI(url + &quot;?query=&quot; + query + &quot;&amp;format=json&quot;);
    $.ajax({
        dataType: &quot;jsonp&quot;,
        url: queryUrl,

        success: success,
        error: ajaxError,
    });
}

/**
* Callback of getMembers ajax request called when the page is article.
* Creates member thumbnails and loads them under article  
*
* @class membersSuccess
* @constructor
* @param {object} _data Ajax request response that contains all members of rank species of a node
*/
function membersSuccess(_data) {
    animals_html = &quot;&quot;;

    var dbpedia_results = _data.results.bindings;

    for (var i in dbpedia_results) { //pass all dbpedia results in array for easier understanding
        var src = dbpedia_results[i].name.value;
        var name = nameFromUrl(src);
        name = name.replace(&quot;_&quot;, &#x27; &#x27;);
        thumb_url = getThumbUrl(dbpedia_results[i].thumb);


        animals_html = animals_html + &quot; &lt;li&gt; &lt;div class=&#x27;thumbnail&#x27;&gt;&lt;img src=&#x27;assets/Timer.gif&#x27; data-src=&#x27;&quot; + thumb_url + &quot;&#x27;width=&#x27;50px&#x27; &gt; &lt;div class=&#x27;caption&#x27;&gt;&lt;p caption=&#x27;&quot; + name + &quot;&#x27;&gt;&quot; + name + &quot;&lt;/p&gt;&lt;/div&gt;&lt;/div&gt;&lt;/li&gt;&quot;;
    }

    $(&#x27;#membersList&#x27;).html(animals_html);
    $(&quot;#membersList .thumbnail&quot;).hide();
    var $thumbnails = $(&quot;#membersList .thumbnail&quot;);
    var time2 = $thumbnails.length * 250;
    setTimeout(function() {
        var time = prettyLoadRank($thumbnails, &#x27;null&#x27;, 250);
        $(&quot;img&quot;).unveil();
    }, 800)
    changeLanguage(sessionStorage.getItem(&#x27;lang&#x27;), &#x27;#membersList&#x27;);
    $(&quot;img&quot;).unveil();

}
/**
* Callback of getMembers ajax request called when the page is index.
* Gets up to 8 most important members of rank species of a node.   
*
* @class importantMembersSuccess
* @constructor
* @param {object} _data Ajax request response that contains all members of rank species of a node
*/ 
  
function importantMembersSuccess(_data) {
    animals_html = &quot;&quot;;
    var k = 0;
    var dbArray = [];
    var dbpedia_results = _data.results.bindings;

    var wikirankResults = [wikirank0, wikirank1, wikirank2, wikirank3,
        wikirank4, wikirank5, wikirank6, wikirank7, wikirank8,
        wikirank9
    ]
    for (var j in dbpedia_results) { //pass all dbpedia results in array for easier understanding
        var src = dbpedia_results[j].name.value;
        var name = nameFromUrl(src);
        dbArray[j] = name;
    }
    if (dbArray.length &lt;= 8) { //Skip the wikirank part if rank has 8 or fewer members
        for (var i in dbArray) {
            thumb_url = getThumbUrl(dbpedia_results[i].thumb);
            src = dbArray[i];
            animals_html = animals_html + getMemberHtml(thumb_url, src);
        }
    } else {

        for (var i in wikirankResults) { //Traverse wikirank data, compare each element to dbpedia results and if it exists add to animal list
            var wikiArray = wikirankResults[i].split(&#x27;,&#x27;);
            for (var j in wikiArray) {
                src = wikiArray[j];
                if ($.inArray(src, dbArray) &gt; -1) {
                    k++;
                    var thumb_url = getThumbUrl(dbpedia_results[$.inArray(src, dbArray)].thumb);
                    animals_html = animals_html + getMemberHtml(thumb_url, src);
                }
                if (k &gt; 7) break;
            }
            if (k &gt; 7) break;
        }
    }
    stopLoading(&#x27;#membersList&#x27;);
    $(&#x27;#membersList&#x27;).html(animals_html);
    $(&quot;#membersList .thumbnail&quot;).hide();
    var $thumbnails = $(&quot;#membersList .thumbnail&quot;);
    var time2 = $thumbnails.length * 250;
    setTimeout(function() {
        var time = prettyLoadRank($thumbnails, &#x27;null&#x27;, 250);
        $(&quot;img&quot;).unveil();
    }, 800)
    changeLanguage(sessionStorage.getItem(&#x27;lang&#x27;), &#x27;#myModal&#x27;);

    $(&quot;img&quot;).unveil();
}
  /*End of details functions*/
  /*Functions that make the tree*/
/**
* Executed when somebody clicks on an open button.
* Sets variables and calls function that creates next rank of tree.
*
* @class $(document).on()
* @constructor
* @param {event} &quot;click&quot; The click event
* @param {string} &quot;.open&quot; A node with class &quot;open&quot;
* @param {function} function 
*/
  
$(document).on(&quot;click&quot;, &quot;.open&quot;, function() {
    $(&#x27;button&#x27;).prop(&#x27;disabled&#x27;, true);
    var name = getName($(this));
    sessionStorage.setItem(&#x27;prevRankName&#x27;, name);

    var rank = getRank($(this));
    console.log(&quot;rank &quot; + rank);
    selectRank($(this), rank); //Make clicked node selected
    var next_rank = getNextRank(rank); //get the next rank
    clearNextRanks(rank); //Clear data of next ranks
    startLoading(&#x27;#&#x27; + next_rank + &#x27;&gt;div&#x27;);
    var query = getOpenQuery(name, rank, next_rank);

    executeOpenQuery(query, next_rank, &quot;open&quot;);

});


  /*Functions that make the tree*/

/**
* Makes ajax request that gets the next rank of the tree.   
*
* @class executeOpenQuery
* @constructor
* @param {string} query Ajax request query
* @param {string} rank The rank
* @param {string} func Variable that determines if function was called for a search or open
* @param {string} selectedName Used for search function
*/ 
function executeOpenQuery(query, rank, func, selectedName) {

    if (selectedName === undefined) {
        selectedName = &#x27;&#x27;;
    }
    checkUrl();
    var queryUrl = encodeURI(url + &quot;?query=&quot; + query + &quot;&amp;format=json&quot;);

    $.ajax({
        type: &quot;GET&quot;,
        dataType: &quot;jsonp&quot;,
        url: queryUrl,
        rank: rank,
        selectedName: selectedName,
        success: openSuccess,
        func: func,
        error: ajaxError
    });
}
/**
* Callback of executeOpenQuery. Loads rank thumbnails in page.  
*
* @class openSuccess
* @constructor
* @param {object} _data Response of ajax request query that contains members of rank
*/ 
function openSuccess(_data) {

    var item = &#x27;&#x27;;
    var thumb_url = &quot;&quot;;
    var rank = this.rank;
    var results = _data.results.bindings;
    if (results.length &gt; 0) { //if there are any results
        for (var i in results) {

            var src = results[i].taxon.value;

            var name = nameFromUrl(src);
            var html = thumbHtml(name, results[i].thumb, rank, this.selectedName);
            var item = item + html;


            stopLoading(&#x27;#&#x27; + rank + &#x27;&gt;div&#x27;);

        }
        $(item).hide();

        $(&quot;#&quot; + rank).append(item);

        var contents = $(&quot;#&quot; + rank + &quot; .selected&quot;).detach();
        $(&#x27;#&#x27; + rank + &quot;&gt;.rankHead&quot;).after(contents);

        var $thumbnails = $(&quot;#&quot; + rank + &quot; .thumbnail&quot;);
        var time = prettyLoadRank($thumbnails, rank);


        setTimeout(function() {

            $(&quot;#&quot; + rank + &quot; .counter&quot;).html(&quot; &quot; + $thumbnails.length);
            $thumbnails.show();
            $(&#x27;.thumbnail&gt;button&#x27;).prop(&#x27;disabled&#x27;, true);
            sessionStorage.setItem(&#x27;treePage&#x27;, $(&#x27;#tree_container&#x27;).html());


            $(&quot;img&quot;).unveil();

        }, time + 100)

    } else {
        stopLoading(&#x27;#&#x27; + rank + &#x27;&gt;div&#x27;);

        if (this.func == &quot;open&quot;) {
            $(&quot;#&quot; + rank).append(&#x27;&lt;span name=&quot;lbl&quot; caption=&quot;noResults&quot;&gt;&lt;/span&gt;&#x27;);
        }
    }
    $(&#x27;button&#x27;).prop(&#x27;disabled&#x27;, false);
    ChangeDiv($(window).width()); //Does changes related to screen size
    changeLanguage(sessionStorage.getItem(&#x27;lang&#x27;), &quot;#&quot; + rank); //does text translation for selected language
}
  /* Functions that make the Search Tree*/
/**
* Gets search term from search box and makes query to find rank of search term.   
*
* @class getSearchRank
* @constructor
* @param {string} func Article or index
*/ 
function getSearchRank(func) {

    //TODO-αν το search term ειναι στα ελληνικά (δηλαδή αν η γλώσσα είναι ελληνικά)να το μεταφράζει. Έχω ετοιμάσει το query στο  returnOneEnglishNameQuery(name)
    $(&#x27;button&#x27;).prop(&#x27;disabled&#x27;, true);
    //An einai plant h Animal na paravlepetai to query
    if (func == &quot;article&quot;) {

        var callback = articleRankSuccess;
    } else {
        var callback = makeSearchTree;
    }
    var name = $(&#x27;#searchBox&#x27;).val();
    if (name == &#x27;&#x27;) {
        name = $(&#x27;#searchBoxMobile&#x27;).val();
    }
    name = name.replace(&#x27; &#x27;, &quot;_&quot;);
    name = capitalizeFirstLetter(name);

    var query = getSearchRankQuery(name);
    console.log(query);
    checkUrl();
    var queryUrl = encodeURI(url + &quot;?query=&quot; + query + &quot;&amp;format=json&quot;);
    $.ajax({
        dataType: &quot;jsonp&quot;,
        url: queryUrl,
        name: name,
        success: callback,
        error: ajaxError
    });
}
/**
* Callback from getSearchRank. Finds rank of search term and makes ajax request to make search tree. 
* The rank for the search term is the one with the highest count.    
*
* @class getSearchRank
* @constructor
* @param {object} _data Response of ajax request query that contains count for each rank
*/ 
function makeSearchTree(_data) {
    var values = [&#x27;&#x27;, &#x27;&#x27;, &#x27;&#x27;, &#x27;&#x27;, &#x27;&#x27;]
    var checkValue = 0;
    //find rank of searched term
    var results = _data.results.bindings[0];
    values[0] = results.countphylum.value;
    values[1] = results.countclass.value;
    values[2] = results.countorder.value;
    values[3] = results.countfamily.value;
    values[4] = results.countgenus.value;
    for (var i in values) {
        if (values[i] != 0) checkValue = values[i];
    }

    //Find index of max value, and add 1 to use with rankArray  
    if (checkValue == 0) {
        index = 6; //Search term is species	
    } else {
        maxValue = Math.max.apply(this, values);
        var index = $.inArray(maxValue.toString(), values) + 1;
    }

    var query = getSearchQuery(this.name, rankArray[index]);
    console.log(query);
    checkUrl();
    var queryUrl = encodeURI(url + &quot;?query=&quot; + query + &quot;&amp;format=json&quot;);
    $.ajax({
        dataType: &quot;jsonp&quot;,
        url: queryUrl,
        index: index,
        name: this.name,
        success: makeSearchTreeSuccess,
        error: ajaxError
    });
}
/**
* Callback from makeSearchTree. Gets members of all ranks up to the search term and calls
* executeopenquery for each one.    
*
* @class getSearchRank
* @constructor
* @param {object} _data Response of ajax request query that contains count for each rank
*/ 
function makeSearchTreeSuccess(_data) {
    var name = this.name;
    clearNextRanks(&quot;kingdom&quot;); //Clear data of all ranks
    var kingdomType = &#x27;&#x27;;
    var results = _data.results.bindings;
    console.log
    var maxValue = [0, 0, 0, 0, 0, 0];
    var values = [&#x27;&#x27;, &#x27;&#x27;, &#x27;&#x27;, &#x27;&#x27;, &#x27;&#x27;, &#x27;&#x27;];
    var tempName = &#x27;&#x27;;

    for (var i in results) {
        if (results[i].countkingdom !== undefined) {
            if (parseInt(results[i].countkingdom.value) &gt; maxValue[0]) {
                maxValue[0] = parseInt(results[i].countkingdom.value);
                tempName = nameFromUrl(results[i].kingdom.value);

                values[0] = tempName.replace(&#x27; &#x27;, &quot;_&quot;);
            }
        }
        if (results[i].countphylum !== undefined) {
            if (parseInt(results[i].countphylum.value) &gt; maxValue[1]) {
                maxValue[1] = parseInt(results[i].countphylum.value);
                tempName = nameFromUrl(results[i].phylum.value);

                values[1] = tempName.replace(&#x27; &#x27;, &quot;_&quot;);
            }
        }
        if (results[i].countclassis !== undefined) {
            if (parseInt(results[i].countclassis.value) &gt; maxValue[2]) {
                maxValue[2] = parseInt(results[i].countclassis.value);
                tempName = nameFromUrl(results[i].classis.value);

                values[2] = tempName.replace(&#x27; &#x27;, &quot;_&quot;);
            }
        }
        if (results[i].countorder !== undefined) {
            if (parseInt(results[i].countorder.value) &gt; maxValue[3]) {
                maxValue[3] = parseInt(results[i].countorder.value);
                tempName = nameFromUrl(results[i].order.value);

                values[3] = tempName.replace(&#x27; &#x27;, &quot;_&quot;);
            }
        }
        if (results[i].countfamily !== undefined) {
            if (parseInt(results[i].countfamily.value) &gt; maxValue[4]) {
                maxValue[4] = parseInt(results[i].countfamily.value);
                tempName = nameFromUrl(results[i].family.value);

                values[4] = tempName.replace(&#x27; &#x27;, &quot;_&quot;);
            }
        }
        if (results[i].countgenus !== undefined) {
            if (parseInt(results[i].countgenus.value) &gt; maxValue[5]) {
                maxValue[5] = parseInt(results[i].countgenus.value);
                tempName = nameFromUrl(results[i].genus.value);

                values[5] = tempName.replace(&#x27; &#x27;, &quot;_&quot;);
            }
        }



    }
    if (values[0] == &#x27;Animal&#x27; || values[0] == &#x27;Animalia&#x27;) values[0] = &quot;Animal&quot;;
    if (values[0] == &#x27;Plant&#x27; || values[0] == &#x27;Plantae&#x27;) values[0] = &quot;Plant&quot;;
    if (values[0] == &#x27;Animal&#x27; || values[0] == &#x27;Plant&#x27;) { //Only make tree if kingdom is plant or animal
        //TODO add species 
        for (i = 0; i &lt; this.index; i++) {
            var query = getOpenQuery(values[i], rankArray[i], rankArray[i + 1]);
            startLoading(&#x27;#&#x27; + rankArray[i + 1] + &#x27;&gt;div&#x27;);
            if (values[i + 1] == &#x27;&#x27;) {
                values[i + 1] = name;
            }
            executeOpenQuery(query, rankArray[i + 1], &quot;tree&quot;, values[i + 1]);
        }
        selectRank($(&#x27;p[caption=&quot;&#x27; + values[0] + &#x27;&quot;]&#x27;), rankArray[0]);
    }

    $(&#x27;button&#x27;).prop(&#x27;disabled&#x27;, false);

}
/*End of tree functions*/
  /*Helper functions*/
  
/**
* Creates html for thumbnail. 
*
* @class thumbHtml
* @constructor
* @param {string} name Name of node
* @param {string} thumb Image url for node
* @param {string} rank Rank of node
* @param {string} selectedName Used for search tree where node is selected automatically and not by the user 
*/ 

function thumbHtml(name, thumb, rank, selectedName) {
    thumb_url = getThumbUrl(thumb);
    name = name.replace(&quot;_&quot;, &quot; &quot;);
    if (selectedName == name) {
        select = &quot;selected&quot;;
    } else {
        select = &quot;&quot;;
    }
    if (rank != &quot;species&quot;) {
        return &#x27;   &lt;div class=&quot;thumbnail clearfix &#x27; + select + &#x27;&quot;&gt;&#x27; + &#x27;&lt;img class=&quot;img-rounded&quot; src=&quot;assets/Timer.gif&quot; data-src=\&quot;&#x27; + thumb_url + &#x27;\&quot; alt=\&quot;...\&quot;&gt;&lt;div class=\&quot;caption\&quot;&gt;&#x27; + &#x27;&lt;p caption=\&quot;&#x27; + name + &#x27;\&quot;&gt;&lt;/p&gt;&#x27; + &#x27;&lt;div class=&quot;btn-group&quot; role=&quot;group&quot; aria-label=&quot;...&quot;&gt; &lt;button name=&quot;lbl&quot; caption=&quot;details&quot; class=&quot;btn btn-info details&quot;data-target=&quot;#myModal&quot; data-toggle=&quot;modal&quot; type=&quot;button&quot;&gt;&lt;/button&gt;  &lt;button type=&quot;button&quot;class=&quot;btn btn-default open &quot;&gt;&lt;span class=&quot;glyphicon glyphicon-menu-right&quot; aria-hidden=&quot;true&quot;&gt;&lt;/span&gt;&lt;/button&gt;&lt;/div&gt;&#x27; + &#x27;&lt;/div&gt;   &#x27; + &#x27;&lt;/div&gt;&#x27;;
    } else {
        return &#x27;   &lt;div class=\&quot;thumbnail clearfix &#x27; + select + &#x27;&quot;&gt;&#x27; + &#x27;&lt;img class=&quot;img-rounded&quot; src=&quot;assets/Timer.gif&quot; data-src=\&quot;&#x27; + thumb_url + &#x27;\&quot; alt=\&quot;...\&quot;&gt;&#x27; + &#x27;&lt;div class=\&quot;caption\&quot;&gt;&lt;p caption=&quot;&#x27; + name + &#x27;&quot;&gt;&#x27; + &#x27;&lt;/p&gt; &lt;button name=&quot;lbl&quot; caption=&quot;details&quot; class=&quot;btn btn-info details&quot; data-target=&quot;#myModal&quot; data-toggle=&quot;modal&quot;type=&quot;button&quot;&gt;&lt;/button&gt;&#x27; + &#x27;&lt;/div&gt;   &#x27; + &#x27;&lt;/div&gt;&#x27;;
    }
}
/**
* Clears next ranks of data to insert new nodes. 
*
* @class clearNextRanks
* @constructor
* @param {string} rank Rank of node
*/ 
function clearNextRanks(rank) {
    var rank_index = rankArray.indexOf(rank);
    for (i = rank_index + 1; i &lt; rankArray.length; i++) {
        $(&quot;#&quot; + rankArray[i] + &#x27;&gt;.thumbnail&#x27;).remove(); //remove thumbnail divs
        $(&quot;#&quot; + rankArray[i] + &#x27;&gt;span&#x27;).remove(); //remove spans with text 
        contents = $(&quot;#&quot; + rankArray[i]).detach();
        $(&quot;#&quot; + rankArray[i - 1]).after(contents);
        $(&quot;#&quot; + rankArray[i] + &#x27; .counter&#x27;).html(&quot;&quot;);
    }
}
/**
* Returns shrinked thumbnail url or placeholder image if image doesn&#x27;t exist. 
*
* @class getThumbUrl
* @constructor
* @param {string} thumb Thumbnail url
*/ 
function getThumbUrl(thumb) {
    if (thumb === undefined) { //replace with placeholder image if image doesn&#x27;t exist
        return &quot;assets/no_img_thumb.jpg&quot;
    } else {
        return shrinkImg200(thumb.value);
    }
}

/**
* Returns name by reading caption closest to object.  
*
* @class getName
* @constructor
* @param {object} obj Dom object, usually thumbnail
*/ 
function getName(obj) {
    return obj.closest(&#x27;.thumbnail&#x27;).find(&#x27;.caption&gt;p[caption]&#x27;).attr(&#x27;caption&#x27;);
}

/**
* Returns rank of thumbnail.  
*
* @class getName
* @constructor
* @param {object} obj Dom object, usually thumbnail
*/ 
function getRank(obj) {

    var rank = obj.parents(&#x27;div:eq(3)&#x27;).attr(&#x27;id&#x27;);

    return rank;
}

/**
* Returns html for member thumbnail.  
*
* @class getName
* @constructor
* @param {string} thumb_url Url of image
* @param {string} src Name of member
*/ 
function getMemberHtml(thumb_url, src) {
    return &quot; &lt;li&gt; &lt;div class=&#x27;thumbnail&#x27;&gt;&lt;img src=&#x27;&quot; + thumb_url + &quot;&#x27;  data-src=&#x27;&quot; + thumb_url + &quot;&#x27;width=&#x27;50px&#x27; &gt; &lt;div class=&#x27;caption&#x27;&gt;&lt;p caption=&#x27;&quot; + src + &quot;&#x27;&gt;&quot; + src + &quot;&lt;/p&gt;&lt;/div&gt;&lt;/div&gt;&lt;/li&gt;&quot;;
}
/**
* Make a node selected. 
*
* @class getName
* @constructor
* @param {obj} button Button that was clicked
* @param {string} rank Name of rank
*/ 
function selectRank(button, rank) {
    var selected = button.closest(&#x27;.thumbnail&#x27;);

    $(&#x27;#&#x27; + rank + &#x27; .thumbnail&#x27;).removeClass(&#x27;selected&#x27;);
    selected.addClass(&#x27;selected&#x27;);
    //selected.insertAfter($(&#x27;#&#x27; + rank + &#x27;&gt;.rankHead&#x27;)); //TODO return to original position when unselected
}
/**
* Adds loading span when something starts loading.  
*
* @class startLoading
* @constructor
* @param {obj} container Container to add loading span
*/ 
function startLoading(container) {
 $(container).after(&quot;&lt;span&gt;&lt;span class=&#x27;glyphicon glyphicon-refresh glyphicon-refresh-animate&#x27;&gt;&lt;/span&gt; Loading...&lt;/span&gt;&quot;);
}
/**
* Removes loading span when something stops loading.  
*
* @class stopLoading
* @constructor
* @param {obj} container Container to remove loading span from
*/ 
function stopLoading(container) {
  $(container).next(&quot;span&quot;).remove();
}
/**
* Returns image with width of 150 pixels.  
*
* @class shrinkImg200
* @constructor
* @param {string} thumb_url Url of image
*/ 
function shrinkImg200(thumb_url) {
  var shrinkedImg = thumb_url.replace(&#x27;width=300&#x27;, &#x27;width=150&#x27;);
  return shrinkedImg;
}
/**
* Returns image with width of 300 pixels.  
*
* @class shrinkImg300
* @constructor
* @param {string} thumb_url Url of image
*/ 
function getImg300(thumb_url) {
  var bigImg = thumb_url.replace(&#x27;width=150&#x27;, &#x27;width=300&#x27;);
  return bigImg;
}
/**
* Toggle hiding and showing of divs. 
*
* @class hideShowDivs
* @constructor
*
*/ 
function hideShowDivs() {
    for (i = 1; i &lt; rankArray.length; i++) {
        if ($(&#x27;#&#x27; + rankArray[i] + &#x27;&gt;*&#x27;).length == 1) {
            $(&#x27;#&#x27; + rankArray[i]).hide();
        } else {
            $(&#x27;#&#x27; + rankArray[i]).show();
        }
    }
}
/**
* Show all divs.
*
* @class showAllDivs
* @constructor
*
*/ 
function showAllDivs() {
    for (i = 1; i &lt; rankArray.length; i++) {
        $(&#x27;#&#x27; + rankArray[i]).show();
    }
}
/**
* Rearrange divs for mobile. 
*
* @class divsForMobile
* @constructor
*
*/ 
function divsForMobile() {
  for (i = 0; i &lt; rankArray.length - 1; i++) {
    if ($(&#x27;#&#x27; + rankArray[i]).find(&#x27;.selected&#x27;).length) {
      var contents = $(&#x27;#&#x27; + rankArray[i + 1]).detach();
      $(&#x27;#&#x27; + rankArray[i]).find(&#x27;.selected&#x27;).after(contents);
    }
  }
}
/**
* Rearrange divs for normal page. 
*
* @class normalDivs
* @constructor
*
*/ 
function normalDivs() {
  for (i = 0; i &lt; rankArray.length - 1; i++) {
    var contents = $(&#x27;#&#x27; + rankArray[i + 1]).detach();
    $(&#x27;#&#x27; + rankArray[i]).after(contents);
  }
}
/**
* Change divs according to width. 
*
* @class ChangeDiv
* @constructor
* @param {number} width Width of browser window
*/ 
function ChangeDiv(width) {
    if (width &lt;= 480) {
        //put img in button
        $(&quot;.col-sm-1&gt;.thumbnail&gt;img&quot;).wrap(&#x27;&lt;button class=&quot;btn btn-info details&quot; data-target=&quot;#myModal&quot; data-toggle=&quot;modal&quot; type=&quot;button&quot;&gt; &lt;/button&gt;&#x27;);
        $(&quot;.glyphicon-menu-right&quot;).addClass(&quot;glyphicon-plus-sign&quot;);
        $(&quot;.glyphicon-menu-right&quot;).removeClass(&quot;glyphicon-menu-right&quot;);
        divsForMobile();
        hideShowDivs();
    } else {
        //remove img from button
        $(&quot;button&gt;.img-rounded&quot;).unwrap();
        $(&quot;.glyphicon-plus-sign&quot;).addClass(&quot;glyphicon-menu-right&quot;);
        $(&quot;.glyphicon-plus-sign&quot;).removeClass(&quot;glyphicon-plus-sign&quot;);
        normalDivs();
        showAllDivs();
    }
}
/**
* Capitalize first letter of string. 
*
* @class capitalizeFirstLetter
* @constructor
* @param {string} string A string
*/ 
function capitalizeFirstLetter(string) {
    return string.charAt(0).toUpperCase() + string.slice(1);
}

  /*End of helper functions*/
    </pre>
</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="../assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>
<script src="../assets/js/yui-prettify.js"></script>
<script src="../assets/../api.js"></script>
<script src="../assets/js/api-filter.js"></script>
<script src="../assets/js/api-list.js"></script>
<script src="../assets/js/api-search.js"></script>
<script src="../assets/js/apidocs.js"></script>
</body>
</html>
